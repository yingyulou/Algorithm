#include <stdio.h>
#include <stdlib.h>
#include <stddef.h>

////////////////////////////////////////////////////////////////////////////////
// Struct PriorityQueue
////////////////////////////////////////////////////////////////////////////////

typedef struct
{
    size_t  __size;
    size_t  __cap;
    int    *__data;
} PriorityQueue;


////////////////////////////////////////////////////////////////////////////////
// PriorityQueue Constructor
////////////////////////////////////////////////////////////////////////////////

void priorityQueueConstructor(PriorityQueue *this)
{
    this->__size = 0;
    this->__cap  = 0;
    this->__data = 0;
}


////////////////////////////////////////////////////////////////////////////////
// Int Swap
////////////////////////////////////////////////////////////////////////////////

void __intSwap(int *lhs, int *rhs)
{
    int tmp = *lhs;
    *lhs    = *rhs;
    *rhs    = tmp;
}


////////////////////////////////////////////////////////////////////////////////
// Get Owner Idx
////////////////////////////////////////////////////////////////////////////////

size_t __getOwnerIdx(size_t idx)
{
    return (idx + 1) / 2 - 1;
}


////////////////////////////////////////////////////////////////////////////////
// Get Left Idx
////////////////////////////////////////////////////////////////////////////////

size_t __getLeftIdx(size_t idx)
{
    return (idx + 1) * 2 - 1;
}


////////////////////////////////////////////////////////////////////////////////
// Get Right Idx
////////////////////////////////////////////////////////////////////////////////

size_t __getRightIdx(size_t idx)
{
    return (idx + 1) * 2;
}


////////////////////////////////////////////////////////////////////////////////
// Push Heap
////////////////////////////////////////////////////////////////////////////////

void __pushHeap(int *data, size_t size)
{
    for
    (
        size_t thisIdx = size - 1,

        ownerIdx = __getOwnerIdx(thisIdx);

        thisIdx > 0 && data[thisIdx] > data[ownerIdx];

        __intSwap(data + thisIdx, data + ownerIdx),

        thisIdx = ownerIdx,

        ownerIdx = __getOwnerIdx(thisIdx)
    );
}


////////////////////////////////////////////////////////////////////////////////
// Get Max Idx
////////////////////////////////////////////////////////////////////////////////

size_t __getMaxIdx(int *data, size_t size, size_t thisIdx, size_t leftIdx,
    size_t rightIdx)
{
    size_t maxIdx = thisIdx;

    if (leftIdx < size && data[leftIdx] > data[maxIdx])
    {
        maxIdx = leftIdx;
    }

    if (rightIdx < size && data[rightIdx] > data[maxIdx])
    {
        maxIdx = rightIdx;
    }

    return maxIdx;
}


////////////////////////////////////////////////////////////////////////////////
// Pop Heap
////////////////////////////////////////////////////////////////////////////////

void __popHeap(int *data, size_t size)
{
    __intSwap(data, data + size-- - 1);

    for
    (
        size_t thisIdx = 0,

        maxIdx = __getMaxIdx(data, size, thisIdx,
            __getLeftIdx(thisIdx), __getRightIdx(thisIdx));

        thisIdx < maxIdx;

        __intSwap(data + thisIdx, data + maxIdx),

        thisIdx = maxIdx,

        maxIdx = __getMaxIdx(data, size, thisIdx,
            __getLeftIdx(thisIdx), __getRightIdx(thisIdx))
    );
}


////////////////////////////////////////////////////////////////////////////////
// PriorityQueue Push
////////////////////////////////////////////////////////////////////////////////

void priorityQueuePush(PriorityQueue *this, int val)
{
    if (this->__size == this->__cap)
    {
        this->__cap  = (this->__cap + 1) * 2;
        this->__data = (int *)realloc(this->__data, sizeof(int) * this->__cap);
    }

    this->__data[this->__size++] = val;

    __pushHeap(this->__data, this->__size);
}


////////////////////////////////////////////////////////////////////////////////
// PriorityQueue Top
////////////////////////////////////////////////////////////////////////////////

int priorityQueueTop(PriorityQueue *this)
{
    return this->__data[0];
}


////////////////////////////////////////////////////////////////////////////////
// PriorityQueue Pop
////////////////////////////////////////////////////////////////////////////////

void priorityQueuePop(PriorityQueue *this)
{
    __popHeap(this->__data, this->__size--);
}


////////////////////////////////////////////////////////////////////////////////
// PriorityQueue Destructor
////////////////////////////////////////////////////////////////////////////////

void priorityQueueDestructor(PriorityQueue *this)
{
    free(this->__data);
}


////////////////////////////////////////////////////////////////////////////////
// Main
////////////////////////////////////////////////////////////////////////////////

int main()
{
    PriorityQueue priorityQueueObj;

    priorityQueueConstructor(&priorityQueueObj);

    for (int i = 0; i < 10; i++)
    {
        priorityQueuePush(&priorityQueueObj, i);
    }

    for (int _ = 0; _ < 10; _++)
    {
        printf("%d\n", priorityQueueTop(&priorityQueueObj));

        priorityQueuePop(&priorityQueueObj);
    }

    priorityQueueDestructor(&priorityQueueObj);
}
